/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package hu.simonadamprog.dependency.analyzer.core;

import org.gradle.testkit.runner.BuildResult;
import org.gradle.testkit.runner.GradleRunner;
import org.junit.jupiter.api.Test;

import java.io.File;

import static org.junit.jupiter.api.Assertions.assertTrue;

class LibraryConnectionsSearchTaskTest {
    File projectDir = new File("../");
    BuildResult result;

    @Test
    void canRunTaskAndOutputIsRight() {
        runGradleTask();
        asserts();
    }

    private void runGradleTask() {
        result = GradleRunner.create()
                .forwardOutput()
                .withPluginClasspath()
                .withArguments(
                        "searchLibraryConnections",
                        "-Plib=org.yaml:snakeyaml:1.30",
                        "-Plist",
                        "-Pstats",
                        "-Pcircular")
                .withProjectDir(projectDir)
                .build();
    }

    private void asserts() {
        assertInput();
        assertFound();
        assertCircularDependencyWarning();
    }

    private void assertInput() {
        assertTrue(result.getOutput().contains(
                "Given input (trimmed to 200 character length) is: org.yaml:snakeyaml:1.30"));
    }

    private void assertFound() {
        assertTrue(result.getOutput().contains(
                "Library search from given input: FOUND"));
    }

    private void assertCircularDependencyWarning() {
        assertTrue(result.getOutput().contains(
                "!!! Warning !!! Circular dependencies detected"));
    }
}
